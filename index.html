<!DOCTYPE>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>轮播图</title>
	<meta name="description" content="">
	<meta name="keywords" content="">
	<link href="index.css" rel="stylesheet" type="text/css">
</head>
<body>
	<!-- 
		页面
			图片 点 左右按钮
		图片运动
			默认运动方式
			点击按钮运动
			点击圆点运动
			图片改变时圆点样式也要改变
	 -->
	<div class="container">
	 	<ul class="picture">
	 		<li><img src="img/1.jpg" alt=""></li>
	 		<li><img src="img/2.jpg" alt=""></li>
	 		<li><img src="img/3.jpg" alt=""></li>
	 		<li><img src="img/1.jpg" alt=""></li>
	 	</ul>
	 	<div class="btn">
	 		<span class="btn leftBtn">&lt;</span>
	 		<span class="btn rightBtn">&gt;</span>
	 	</div>
	 	<div class="dot">
 			<span class="active"></span>
 			<span></span>
 			<span></span>
	 	</div>
	</div>
	<script type="text/javascript" src="startMove.js"></script>
	<script>
		var picture = document.getElementsByClassName('picture')[0];
		var leftBtn = document.getElementsByClassName('leftBtn')[0];
		var rightBtn = document.getElementsByClassName('rightBtn')[0];
		var dot = document.getElementsByClassName('dot')[0].getElementsByTagName('span');

		var moveWidth = picture.children[0].offsetWidth;
		var num = picture.children.length - 1;

		var timer = null;
		var lock = true;
		var index = 0; 	

		leftBtn.onclick = function () {
			imgChange('right->left');
		}
		rightBtn.onclick = function () {
			imgChange('left->right');
		}

		for(var i=0; i<dot.length; i++){
			(function (myIndex) {
				dot[i].onclick = function () {
					lock = false;
					clearTimeout(timer);
					index = myIndex;
					startMove(picture, {left : - index * moveWidth}, 
						function () {
							lock = true;
							timer = setTimeout(imgChange, 1500);
						changeDot(index);
					})
				}
			})(i)
		}

		function imgChange (direction) {
			if (lock) {
				lock = false;
				clearTimeout(timer);
				if(!direction || direction == 'left->right') {
					index ++;
					startMove (picture, {left : picture.offsetLeft - moveWidth}, function () {
						if(picture.offsetLeft == - num * moveWidth) {
							index = 0;
							picture.style.left = '0px';
						}
						timer = setTimeout(imgChange, 1500);
						lock = true;
						changeDot(index);
					});
				} else if (direction == 'right->left') {
					if(picture.offsetLeft == 0) {
						picture.style.left = - num * moveWidth + 'px';
						index = num;
					}
					index --;
					startMove (picture, {left : picture.offsetLeft + moveWidth}, function () {    
						timer = setTimeout(imgChange, 1500);
						lock = true;
						changeDot(index);
						})
				}
			}
		}

		function changeDot (_index) {
			for(var i=0; i<dot.length; i++) {
				dot[i].className = '';
			}
			dot[_index].className = 'active';
		}

		timer = setTimeout(imgChange, 1500); 
	</script>
</body>
</html>